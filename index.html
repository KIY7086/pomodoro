<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#FFADC6">
    <link rel="manifest" href="/manifest.json">
    <title>专注时钟</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.3/cdn.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/style.css">
    <link rel="apple-touch-icon" href="icons/icon-512x512.png">
    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js')
                .then(registration => {
                    console.log('ServiceWorker registration successful');
                    
                    // 请求通知权限
                    if ('Notification' in window) {
                        Notification.requestPermission();
                    }
                    
                    // 注册定期同步
                    if ('periodicSync' in registration) {
                        registration.periodicSync.register('update-cache', {
                            minInterval: 24 * 60 * 60 * 1000 // 24小时
                        });
                    }
                })
                .catch(err => {
                    console.error('ServiceWorker registration failed:', err);
                });
        });
    }
    </script>
</head>
<body x-data="pomodoroTimer">
    <div class="app-container">
        <div class="session-counter">
            <i class="fas fa-trophy"></i>
            <span>专注次数: <strong x-text="completedSessions"></strong></span>
        </div>

        <div class="main-container">
            <div class="timer-container" @click="toggleTimer">
                <div class="timer-background"></div>
                <svg class="progress-ring" :width="size" :height="size" viewBox="0 0 280 280">
                    <circle class="progress-ring__background" 
                            cx="140" 
                            cy="140" 
                            r="130" 
                            fill="none" 
                            stroke-width="12"/>
                    <circle class="progress-ring__circle" 
                            cx="140" 
                            cy="140" 
                            r="130" 
                            fill="none" 
                            stroke-width="12"
                            :style="progressStyle"/>
                </svg>
                <div class="timer-display" :class="{ 'pulse-animation': isRunning }">
                    <span x-text="formatTime"></span>
                </div>
            </div>

            <div class="timer-label" x-text="timerLabel"></div>

            <!-- 控制按钮组 -->
            <div class="control-buttons">
                <button class="control-btn btn-base" 
                        :class="isRunning ? 'pause' : 'start'"
                        @click="toggleTimer">
                    <i :class="isRunning ? 'fas fa-pause' : 'fas fa-play'"></i>
                    <span x-text="isRunning ? '暂停' : '开始'"></span>
                </button>
                
                <button class="control-btn btn-base reset" 
                        @click="reset"
                        :disabled="!canReset">
                    <i class="fas fa-rotate"></i>
                    <span>重置</span>
                </button>
            </div>
        </div>

        <nav class="navigation">
            <div class="nav-item" 
                 :class="{ 'active': currentMode === 'pomodoro' }"
                 @click="changeMode('pomodoro')">
                <i class="fas fa-lightbulb"></i>
                <span>专注</span>
            </div>
            <div class="nav-item" 
                 :class="{ 'active': currentMode === 'shortBreak' || currentMode === 'longBreak' }"
                 @click="toggleBreakMode">
                <i class="fas" :class="currentMode === 'longBreak' ? 'fa-couch' : 'fa-coffee'"></i>
                <span x-text="currentMode === 'longBreak' ? '长休息' : '短休息'"></span>
            </div>
            
            <div class="nav-center-button" @click="toggleTimer">
                <i :class="isRunning ? 'fas fa-pause' : 'fas fa-play'"></i>
            </div>
        
            <div class="nav-item" @click="openStatsPanel">
                <i class="fas fa-chart-column"></i>
                <span>统计</span>
            </div>
            <div class="nav-item" @click="openSettings">
                <i class="fas fa-gear"></i>
                <span>设置</span>
            </div>
        </nav>
    
        <!-- 设置面板 -->
        <div class="modal" :class="{ 'active': showSettings }" @click="closeSettings">
            <div class="modal-content" @click.stop>
                <div class="modal-header">
                    <h2>设置</h2>
                    <button class="btn-base close-btn" @click="closeSettings">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="settings-group">
                        <h3>主题色</h3>
                        <div class="theme-grid">
                            <button class="theme-button"
                                    :class="{ active: settings.theme === 'first' }"
                                    @click="changeTheme('first')"
                                    style="background: var(--theme-first)">
                            </button>
                            <button class="theme-button"
                                    :class="{ active: settings.theme === 'second' }"
                                    @click="changeTheme('second')"
                                    style="background: var(--theme-second)">
                            </button>
                            <button class="theme-button"
                                    :class="{ active: settings.theme === 'third' }"
                                    @click="changeTheme('third')"
                                    style="background: var(--theme-third)">
                            </button>
                            <button class="theme-button"
                                    :class="{ active: settings.theme === 'fourth' }"
                                    @click="changeTheme('fourth')"
                                    style="background: var(--theme-fourth)">
                            </button>
                            <button class="theme-button"
                                    :class="{ active: settings.theme === 'fifth' }"
                                    @click="changeTheme('fifth')"
                                    style="background: var(--theme-fifth)">
                            </button>
                        </div>
                    </div>
                    <div class="settings-group">
                       <h3>时间设置（分钟）</h3>
                       <div class="time-input">
                           <label>专注时长</label>
                           <input type="number" 
                                  :value="Math.floor(times.pomodoro / 60)"
                                  @input="updateTime('pomodoro', $event.target.value)"
                                  min="1"
                                  max="60">
                       </div>
                       <div class="time-input">
                           <label>短休息时长</label>
                           <input type="number" 
                                  :value="Math.floor(times.shortBreak / 60)"
                                  @input="updateTime('shortBreak', $event.target.value)"
                                  min="1"
                                  max="60">
                       </div>
                       <div class="time-input">
                           <label>长休息时长</label>
                           <input type="number" 
                                  :value="Math.floor(times.longBreak / 60)"
                                  @input="updateTime('longBreak', $event.target.value)"
                                  min="1"
                                  max="60">
                       </div>
                   </div>
       
                   <div class="settings-group">
                       <h3>通知设置</h3>
                       <div class="switch-group">
                           <label class="switch-label">声音提醒</label>
                           <label class="switch">
                               <input type="checkbox" x-model="settings.soundEnabled">
                               <span class="switch-slider"></span>
                           </label>
                       </div>
                       <div class="switch-group">
                           <label class="switch-label">通知开关</label>
                           <label class="switch">
                               <input type="checkbox" 
                                      x-model="settings.notificationsEnabled"
                                      @change="requestNotificationPermission">
                               <span class="switch-slider"></span>
                           </label>
                       </div>
                       <div class="switch-group">
                           <label class="switch-label">自动开始休息</label>
                           <label class="switch">
                               <input type="checkbox" x-model="settings.autoStartBreak">
                               <span class="switch-slider"></span>
                           </label>
                       </div>
                       <div class="switch-group">
                           <label class="switch-label">自动开始专注</label>
                           <label class="switch">
                               <input type="checkbox" x-model="settings.autoStartPomodoro">
                               <span class="switch-slider"></span>
                           </label>
                       </div>
                   </div>
       
                   <div class="settings-group">
                       <h3>其他设置</h3>
                       <div class="time-input">
                           <label>长休息间隔（次数）</label>
                           <input type="number" 
                                  :value="settings.longBreakInterval"
                                  @input="settings.longBreakInterval = Math.max(1, parseInt($event.target.value) || 4)"
                                  min="1"
                                  max="10">
                       </div>
                   </div>
               </div>
           </div>
       </div>
       
       <!-- 统计面板 -->
       <div class="modal" :class="{ 'active': showStatsPanel }" @click="closeStatsPanel">
           <div class="modal-content" @click.stop>
               <div class="modal-header">
                   <h2>专注统计</h2>
                   <button class="btn-base close-btn" @click="closeStatsPanel">
                       <i class="fas fa-times"></i>
                   </button>
               </div>
               <div class="modal-body">
                   <div class="stats-grid">
                       <div class="stats-item">
                           <div class="stats-value" x-text="completedSessions"></div>
                           <div class="stats-label">总专注次数</div>
                       </div>
                       <div class="stats-item">
                           <div class="stats-value" x-text="todaySessions"></div>
                           <div class="stats-label">今日专注</div>
                       </div>
                       <div class="stats-item">
                           <div class="stats-value" x-text="Math.floor(totalFocusTime / 60)"></div>
                           <div class="stats-label">总专注时长(分钟)</div>
                       </div>
                       <div class="stats-item">
                           <div class="stats-value" x-text="currentStreak"></div>
                           <div class="stats-label">连续专注天数</div>
                       </div>
                   </div>
                   <div class="stats-actions">
                       <button class="btn btn-base" @click="resetStats">
                           <i class="fas fa-refresh"></i>
                           重置统计
                       </button>
                   </div>
               </div>
           </div>
       </div>
       
       <!-- Toast 通知 -->
        <div class="toast" 
             :class="{ 'show': toast.show, [toast.type]: true }"
             x-show="toast.show"
             x-transition:enter="transition-transform duration-300"
             x-transition:enter-start="translate-y-full opacity-0"
             x-transition:enter-end="translate-y-0 opacity-100"
             x-transition:leave="transition-transform duration-300"
             x-transition:leave-start="translate-y-0 opacity-100"
             x-transition:leave-end="translate-y-full opacity-0"
             @click="hideToast">
            <i :class="toast.icon"></i>
            <span x-text="toast.message"></span>
        </div>
    </div>
    <script src="/main.js"></script>
</body>
</html>